#################################################################################
# FALLOUT PIP-BOY TERMINAL - COMPLETE GLOBAL THEME (v2.7)
# Optimized: Green Icons, Ultra-tight Gaps & Panel View Fix
# Author: Home Assistant Architect @ JrX-Code
#################################################################################

transparent-fallout:
  #################################################################################
  # 1. COLOR VARIABLES
  #################################################################################
  active-color: '#14F514'
  text-color: '#14F514'
  text-dark-color: '#006400'
  
  # --- Ikony (Globalny Phosphor Green) ---
  state-icon-color: 'var(--active-color)'
  state-icon-active-color: 'var(--active-color)'
  paper-item-icon-color: 'var(--active-color)'
  paper-item-icon-active-color: 'var(--active-color)'
  sidebar-icon-color: 'var(--active-color)'
  sidebar-selected-icon-color: 'var(--active-color)'

  # --- Odstępy (Ultra-ciaśniejszy układ dla widoku Panel) ---
  grid-card-gap: "2px"
  stack-card-margin: "1px"
  masonry-view-card-margin: "2px"

  # --- Tło i Główne Kolory ---
  main-color-tp: 'rgba(0, 40, 0, 0.4)'
  main-color-2: 'rgba(0, 20, 0, 1)'
  main-color-3: 'rgba(0, 10, 0, 1)'
  
  primary-background-color: 'var(--main-color-3)'
  secondary-background-color: 'var(--main-color-3)'
  accent-color: 'var(--active-color)'
  primary-text-color: 'var(--text-color)'
  secondary-text-color: 'var(--text-color)'
  
  ha-card-background: 'transparent'
  ha-card-border-radius: '15px'
  ha-card-box-shadow: 'none'
  
  # Kolory podstawowe (używane w obliczeniach Mushroom)
  mush-rgb-active-color: 20, 245, 20    # Twoja zieleń #14F514 w formacie RGB
  mush-rgb-disabled-color: 0, 68, 0    # Ciemna zieleń dla stanów OFF

  # Nadpisanie kolorów ikon Mushroom
  mush-icon-symbol-fcolor: var(--active-color)
  mush-icon-fcolor: var(--active-color)
  mush-icon-fixed-color: var(--active-color)
  
  # Stany (On/Off)
  mush-rgb-state-entity: var(--mush-rgb-active-color)
  mush-rgb-state-light: var(--mush-rgb-active-color)
  mush-rgb-state-fan: var(--mush-rgb-active-color)
  mush-rgb-state-switch: var(--mush-rgb-active-color)
  
  # Jeśli ikony mają być zawsze zielone, niezależnie od stanu:
  mush-icon-color: var(--active-color)
  
  # Opcjonalnie: czcionka dla Mushroom
  mush-card-primary-font-family: 'Courier New'
  mush-card-secondary-font-family: 'Courier New'
  
  lovelace-background: 'center / cover no-repeat fixed url("/local/fallout-bg.jpg")'

  #################################################################################
  # 2. CARD-MOD GLOBAL INJECTION
  #################################################################################
  card-mod-theme: transparent-fallout

  # A. STYLIZACJA KART & MUSHROOM OVERRIDES
  card-mod-card-yaml: |
    .: |
      ha-card {
        background-color: transparent !important;
        background-image: 
          radial-gradient(circle at center, rgba(0,50,0,0.1) 0%, rgba(0,0,0,0.8) 100%), 
          repeating-linear-gradient(transparent 0px, transparent 2px, rgba(0, 255, 0, 0.25) 3px, rgba(0, 255, 0, 0.25) 4px) !important;
        background-size: 100% 100% !important;
        border: 4px solid #2a2a2a !important;
        box-shadow: inset 0 0 30px rgba(0,255,0,0.15), 0 0 20px rgba(0,0,0,0.8) !important;
        color: var(--active-color) !important;
        font-family: 'Courier New', monospace !important;
        text-shadow: 0 0 4px var(--active-color), 0 0 8px rgba(0,200,0,0.6) !important;
        animation: crt-flicker 0.15s infinite !important;
        overflow: hidden !important;
      }
      @keyframes crt-flicker {
        0% { opacity: 0.98; }
        50% { opacity: 1; }
        100% { opacity: 0.99; }
      }

    mushroom-cover-position-control$: |
      mushroom-slider {
        --main-color: #14F514 !important;
        --bg-color: rgba(0, 30, 0, 0.9) !important;
      }
      
    mushroom-shape-icon$: |
      .shape { border: 2.5px outset #14F514 !important; }

  # B. GLOBALNY EFEKT WIDOKU (Overlays & Padding)
  card-mod-view-yaml: |
    .: |
      #view {
        padding: 4px 0px 0px 0px !important;
      }
      ha-app-layout::before {
        content: "";
        position: fixed;
        inset: 0;
        background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.15) 50%),
                    linear-gradient(90deg, rgba(255, 0, 0, 0.02), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.02));
        background-size: 100% 3px, 2px 100%;
        z-index: 10;
        pointer-events: none;
      }
      ha-app-layout::after {
        content: "";
        position: fixed;
        inset: 0;
        background: rgba(18, 16, 16, 0.05);
        z-index: 11;
        pointer-events: none;
        animation: global-flicker 0.12s infinite, global-scanline 8s linear infinite;
      }
      @keyframes global-flicker {
        0% { opacity: 0.1; }
        50% { opacity: 0.13; }
        100% { opacity: 0.1; }
      }
      @keyframes global-scanline {
        0% {
          background: linear-gradient(to bottom, transparent 0%, rgba(20, 245, 20, 0.1) 50%, transparent 100%);
          background-size: 100% 30px;
          background-repeat: no-repeat;
          background-position: 0 -30px;
        }
        100% {
          background: linear-gradient(to bottom, transparent 0%, rgba(20, 245, 20, 0.1) 50%, transparent 100%);
          background-size: 100% 30px;
          background-repeat: no-repeat;
          background-position: 0 100vh;
        }
      }

  # C. FIX DLA PANELU BOCZNEGO I ELEMENTÓW ROOT
  card-mod-root-yaml: |
    ha-app-layout {
      --active-color: #14F514;
    }